@{
    if (ViewData.TryGetValue("ParentLayout", out var parentLayout) && parentLayout != null)
    {
        Layout = parentLayout.ToString();
    }
    else
    {
        Layout = "/Views/Shared/_Layout.cshtml";
    }
}

<!-- Modern Tab-Based Profile Navigation -->
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-12 col-xl-10">

            <!-- Page Title -->
            <div class="text-center mb-4">
                <h1 class="text-black">Account Management</h1>
                <p class="text-muted">Manage your profile, security, and privacy settings</p>
            </div>

            <!-- Navigation Tabs -->
            <div class="card mb-4">
                <div class="card-header bg-transparent pb-0 border-bottom-0">
                    <ul class="nav nav-tabs" role="tablist">

                        <!-- Profile Tab -->
                        <li class="nav-item">
                            <a class="nav-link @ManageNavPages.IndexNavClass(ViewContext)"
                               asp-page="./Index" role="tab">
                                Profile
                            </a>
                        </li>

                        <!-- Email Tab -->
                        <li class="nav-item">
                            <a class="nav-link @ManageNavPages.EmailNavClass(ViewContext)"
                               asp-page="./Email" role="tab">
                                Email
                            </a>
                        </li>

                        <!-- Password Tab -->
                        <li class="nav-item">
                            <a class="nav-link @ManageNavPages.ChangePasswordNavClass(ViewContext)"
                               asp-page="./ChangePassword" role="tab">
                                Password
                            </a>
                        </li>

                        <!-- Two-Factor Tab -->
                        <li class="nav-item">
                            <a class="nav-link @ManageNavPages.TwoFactorAuthenticationNavClass(ViewContext)"
                               asp-page="./TwoFactorAuthentication" role="tab">
                                Security
                            </a>
                        </li>

                        <!-- Delete Account Tab (appears last, styled differently) -->
                        <li class="nav-item ms-auto">
                            <a class="nav-link text-danger" href="#" role="tab"
                               data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                                Delete
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Tab Content -->
                <div class="card-body">
                    @RenderBody()
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Account Confirmation Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteAccountModalLabel">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>Delete Account
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" asp-page="/Account/Manage/DeleteAccount" asp-page-handler="Delete">
                <div class="modal-body">
                    <div class="alert alert-danger mb-3">
                        <strong>Warning: This action is permanent and cannot be undone.</strong>
                    </div>
                    <p>Deleting your account will permanently remove:</p>
                    <ul>
                        <li>Your profile information and settings</li>
                        <li>Your account credentials and login access</li>
                        <li>All associated data stored in the system</li>
                    </ul>

                    <div class="mb-3">
                        <label for="deletePassword" class="form-label">Confirm your password</label>
                        <input type="password" class="form-control" id="deletePassword" name="Input.Password"
                               autocomplete="current-password" placeholder="Enter your password" required />
                    </div>

                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="deleteConfirmCheck" name="Input.ConfirmDeletion" value="true" />
                        <label class="form-check-label" for="deleteConfirmCheck">
                            I understand that deleting my account is <strong>permanent and irreversible</strong>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger" id="deleteAccountBtn" disabled>
                        <i class="bi bi-trash3 me-1"></i>Permanently Delete
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @RenderSection("Scripts", required: false)
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var checkbox = document.getElementById('deleteConfirmCheck');
            var deleteBtn = document.getElementById('deleteAccountBtn');
            if (checkbox && deleteBtn) {
                checkbox.addEventListener('change', function () {
                    deleteBtn.disabled = !this.checked;
                });
            }
            // Reset modal state when closed
            var modal = document.getElementById('deleteAccountModal');
            if (modal) {
                modal.addEventListener('hidden.bs.modal', function () {
                    if (checkbox) checkbox.checked = false;
                    if (deleteBtn) deleteBtn.disabled = true;
                    var pwField = document.getElementById('deletePassword');
                    if (pwField) pwField.value = '';
                });
            }
        });
    </script>
}
